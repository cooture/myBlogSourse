---
title: 汇编第九章：转移指令的原理
date: 2017-12-30 17:41:24
tags:
	- 汇编语言
	- 笔记
categories: 汇编语言
---

# 汇编第九章：转移指令的原理
> 概括地讲，转移指令就是可以控制CPU执行内存中某处代码的指令。  
> 表现为可以修改IP或者同时修改CS和IP的指令。

以下讨论8086  
***转移行为的分类***  
**第一类：只修改IP的转移行为叫做段内转移**  
> 根据转一指令对IP的修改范围不同，段内转移可分为。  

1. 短转移：IP的修改范围为-128 ～ 127.
2. 近转移：IP的修改范围为-32768 ～ 32767.

**第二类：同时修改CS和IP的转移行为叫段间转移**   
   
***转一指令的分类*** 
1. 无条件转移指令，例如jmp  
2. 条件转移指令  
3. 循环指令，例如loop  
4. 过程  
5. 中断  

本章主要通过深入学习无条件转移指令jmp来理解CPU执行转移指令的基本原理  

## offset
**功能是取得标号地址的偏移地址**

	code segment
	start:
		mov ax,offset start		;相当于mov ax,0
	s:
		mov ax,offset s			;相当于mov ax,3									
## jmp
jmp为无条件跳转指令，可以只修改IP，也可以同时修改CS和IP。  
jmp指令要给出两种信息：  
1. 转移的目的地址  
2. 转移的距离（段间转移、段内转移、段内近转移）

### 依据位移进行转移的jmp指令
NO.1

	jmp short 标号（转到标号处执行指令）
这种格式实现的事段内短转移，他对IP的修改范围是-128 ～ 127，转移指令结束后，CS:IP应该指向标号指令。  

根据机器码可得出**CPU执行jmp指令时机器码中并不需要转移的目的地址**  
> CPU执行指令的过程  
> 1. 从CS:IP执行内存单元读取指令，读取的指令进入指令缓冲器;  
> 2. (IP) = (IP) + 读取的长度，从而指向下一个指令;  
> 3. 执行指令。转到(1)，重复.

由此可得，执行jmp并不需要目的地址，而是需要**位移地址**  
short的位移量存储空间占一个字节，8个二进制位，首位为符号位，用补码表示，因此可表示的位移量为-128 ～ 127。  
同理，near的位移量储存空间占两个字节，16个二进制位，首位为符号位，用补码表示，因此可表示的位移量为-32768 ～ 32767。

由上引入近转移

	jmp near ptr 标号（段内近转移）
		
### 转移的目的地址在指令中的jmp指令
前面讲的是段内转移，因此jmp只需要位移地址即可进行对IP的修改。
	
	jmp far ptr 标号
以上实现的是段间转移，又称远转移。可以让(CS) = 标号所在的段地址;(IP) = 标号所在的偏移地址。

### 转移地址在寄存器中的jmp指令
	jmp 16位reg
功能：(IP) = (16位reg)  
用寄存器中的值修改IP。

### 转移地址在内存中的jmp指令
> 两种格式  

**段内转移**

	jmp word ptr 内存单元地址 ;(段内转移)
从内存单元地址处开始存放着一个字，是转移的目的的偏移地址。  
例如：

	mov ax,0123H
	mov ds:[0],ax
	jmp word ptr ds:[0]
执行后(IP) = 0123H 

**段间转移**

	jmp dword ptr 内存单元地址  ;(段间转移)
从内存单元地址处开始存放着两个字节，是转移的目的的段地址和偏移地址，**高地址是段地址**，**低地址是偏移地址**  
(CS) = 内存单元地址+2  
(IP) = 内存单元地址
比如一下指令：  

	mov ax,0123H
	mov ds:[0],ax
	mov ax,4567H
	mov ds:[2],ax
	jmp dword ptr ds:[0]
执行完后(CS) = 4567H,(IP) = 0123H。 
		
## jcxz指令
jcxz是有条件转移指令，**所有的有条件转移指令都是短转移指令**，对应的机器码中包含的是转移位移，不是目的地址。对IP的修改范围都是-128 ~ 127。

**jcxz == jmp when cx is zero**  
当cx为零时，执行转移指令，若不为零，则不转移  
使用格式：
	
	jcxz 标号
	
## loop指令
loop指令位循环指令，所有的循环指令都是短转移。  
**详见第五章**

## 根据位移进行转移的意义
	jmp short x
	jmp near ptr x
	jcxz x
	loop
以上都是根据转移的位移量进行转移的，这样有利于程序在内存中的浮动装配，意思就是把这段程序装在内存中的任意一段空间内都可以执行，不会因为转移的地址不同而导致程序不能执行。

## 编译器对转移位移超界的检测
		
**jmp超界编译器会报错**，别的没其他知识点
		
		
		
		
		
		
		